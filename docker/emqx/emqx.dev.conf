# =============================================================================
# EMQX MQTT Broker 配置文件
# IoT设备管理平台 - 开发环境配置
# =============================================================================

# -----------------------------------------------------------------------------
# 节点配置
# -----------------------------------------------------------------------------
node.name = iot-emqx-dev@iot-emqx-dev
node.cookie = emqxdevsecretcookie
node.data_dir = /opt/emqx/data

# -----------------------------------------------------------------------------
# 监听器配置
# -----------------------------------------------------------------------------

# MQTT TCP 监听器
listeners.tcp.default {
    bind = "0.0.0.0:1883"
    max_connections = 1000
    max_conn_rate = 100
    max_packet_size = 1MB
    send_timeout = 15s
    send_timeout_close = on
}

# MQTT WebSocket 监听器
listeners.ws.default {
    bind = "0.0.0.0:8083"
    max_connections = 1000
    max_frame_size = 1MB
    check_origin_enable = false
    allow_origin_absence = true
}

# HTTP API 监听器
listeners.http.default {
    bind = "0.0.0.0:8081"
    max_connections = 100
    max_conn_rate = 100
}

# -----------------------------------------------------------------------------
# Dashboard 配置
# -----------------------------------------------------------------------------
dashboard {
    listeners.http {
        bind = "0.0.0.0:18083"
    }
    default_username = "admin"
    default_password = "public"
    sample_interval = 10s
    enable = true
}

# -----------------------------------------------------------------------------
# 认证配置 - 开发环境允许匿名连接
# -----------------------------------------------------------------------------
allow_anonymous = true

# -----------------------------------------------------------------------------
# ACL 配置 - 开发环境允许所有操作
# -----------------------------------------------------------------------------
authorization {
    sources = [
        {
            type = file
            enable = true
        }
    ]
    no_match = allow
    deny_action = ignore
}

# -----------------------------------------------------------------------------
# 日志配置 - 开发环境详细日志
# -----------------------------------------------------------------------------
log {
    level = debug
    dir = "/opt/emqx/log"
    console_handler {
        enable = true
        level = debug
        time_offset = "+08:00"
    }
    file_handlers {
        default {
            enable = true
            level = debug
            file = "/opt/emqx/log/emqx.log"
        }
    }
}

# -----------------------------------------------------------------------------
# 集群配置 - 单节点
# -----------------------------------------------------------------------------
cluster {
    discovery_strategy = static
    static {
        seeds = ["iot-emqx-dev@iot-emqx-dev"]
    }
}

# -----------------------------------------------------------------------------
# 消息保留配置 - 开发环境较小限制
# -----------------------------------------------------------------------------
retained {
    max_retained_messages = 10000
    max_payload_size = 1MB
    storage_type = ram
}

# -----------------------------------------------------------------------------
# 会话配置
# -----------------------------------------------------------------------------
session {
    max_inflight = 32
    max_awaiting_rel = 100
    await_rel_timeout = 300s
    max_subscriptions = 0
    upgrade_qos = off
    retry_interval = 30s
    max_retry_times = 3
    persistent = false
    max_message_queue_len = 100
}
