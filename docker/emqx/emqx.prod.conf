# EMQX 生产环境覆盖配置
# 只包含与基线不同的配置项

node {
  name = "iot-emqx-prod@iot-emqx-prod"
  cookie = "emqxprodsecretcookie"
}

# 监听器配置 - 生产环境增强
listeners {
  tcp {
    default {
      max_connections = 1024000
      max_conn_rate = 1000
    }
  }
  ws {
    default {
      max_connections = 102400
    }
  }
  wss {
    default {
      bind = "0.0.0.0:8084"
      max_connections = 102400
    }
  }
}

# Dashboard配置 - 生产环境安全
dashboard {
  default_password = "CHANGE_ME_IN_PRODUCTION"
}

# 日志配置 - 生产环境优化
log {
  console_handler {
    enable = false
  }
  file_handlers {
    default {
      level = "info"
    }
    error {
      enable = true
      level = "error"
      file = "/opt/emqx/log/error.log"
    }
    audit {
      enable = true
      level = "info"
      file = "/opt/emqx/log/audit.log"
    }
  }
}

# 认证配置 - 生产环境安全
allow_anonymous = false

authentication = [
  {
    mechanism = password_based
    backend = built_in_database
    enable = true
  }
]

# ACL配置 - 生产环境严格
authorization {
  no_match = "deny"
  deny_action = "disconnect"
}

# 消息保留配置 - 生产环境大容量
retained {
  max_retained_messages = 1000000
  max_storage_size = "1GB"
}

# 会话配置 - 生产环境持久化
session {
  persistent = true
  persistent_session_store = "ram"
  max_persistent_sessions = 1000000
  max_message_queue_len = 1000
}

# 系统监控配置
sysmon {
  vm {
    process_high_watermark = "80%"
    process_low_watermark = "60%"
  }
  os {
    cpu_high_watermark = "80%"
    cpu_low_watermark = "60%"
    mem_high_watermark = "70%"
    mem_low_watermark = "50%"
  }
}