# Redis 生产环境覆盖配置
# 只包含与基线不同的配置项

# 内存管理 - 生产环境增强
maxmemory 512mb
maxmemory-policy allkeys-lru

# 持久化设置 - 生产环境优化
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes

# AOF持久化 - 生产环境优化
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 日志设置 - 生产环境详细
loglevel notice
logfile "/var/log/redis/redis.log"

# 慢查询日志 - 生产环境监控
slowlog-log-slower-than 5000
slowlog-max-len 256

# 客户端设置 - 生产环境扩展
maxclients 10000

# 网络设置 - 生产环境优化
tcp-backlog 1024

# 高级配置 - 生产环境调优
hash-max-ziplist-entries 1024
hash-max-ziplist-value 128
list-max-ziplist-size -2
list-compress-depth 1
set-max-intset-entries 1024
zset-max-ziplist-entries 256
zset-max-ziplist-value 128
hll-sparse-max-bytes 3000
stream-node-max-bytes 8192
stream-node-max-entries 200
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 512mb 128mb 60
client-output-buffer-limit pubsub 64mb 16mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes

# 安全设置 - 生产环境
# requirepass your_redis_password
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command KEYS ""
# rename-command CONFIG ""
