# IoT 平台部署脚本说明

## 📋 脚本列表

### 1. `redeploy.sh` - 智能重新部署（推荐）
**功能**: 关闭服务，清理缓存和垃圾，重新部署，**保留数据库数据**

```bash
./scripts/redeploy.sh
```

**特点**:
- ✅ 保留数据库数据
- ✅ 清理构建缓存和垃圾文件
- ✅ 智能检测数据库是否需要初始化
- ✅ 自动配置 TimescaleDB
- ✅ 彩色输出和进度显示

**适用场景**:
- 代码更新后重新部署
- 清理缓存和垃圾文件
- 日常维护和更新

### 2. `restart.sh` - 快速重启
**功能**: 快速重启所有服务，不清理任何缓存

```bash
./scripts/restart.sh
```

**特点**:
- ⚡ 速度最快
- 🔄 只重启服务
- 📦 保留所有缓存

**适用场景**:
- 配置修改后重启
- 服务异常重启
- 快速恢复服务

### 3. `reset-database.sh` - 数据库完全重置
**功能**: 完全重置数据库，删除所有数据

```bash
./scripts/reset-database.sh
```

**特点**:
- ⚠️ **危险操作**：删除所有数据
- 🔒 双重确认机制
- 🆕 重新初始化数据库

**适用场景**:
- 开发环境重置
- 测试数据清理
- 数据库结构重大变更

## 🚀 使用建议

### 日常开发
```bash
# 代码更新后重新部署（推荐）
./scripts/redeploy.sh
```

### 快速重启
```bash
# 配置修改后快速重启
./scripts/restart.sh
```

### 完全重置（谨慎使用）
```bash
# 开发环境完全重置
./scripts/reset-database.sh
```

## 📊 脚本对比

| 脚本 | 速度 | 清理缓存 | 保留数据 | 适用场景 |
|------|------|----------|----------|----------|
| `redeploy.sh` | 中等 | ✅ | ✅ | 日常部署 |
| `restart.sh` | 最快 | ❌ | ✅ | 快速重启 |
| `reset-database.sh` | 慢 | ✅ | ❌ | 完全重置 |

## ⚠️ 注意事项

1. **数据安全**: `redeploy.sh` 会保留数据库数据，`reset-database.sh` 会删除所有数据
2. **权限要求**: 所有脚本都需要在项目根目录运行
3. **确认操作**: `reset-database.sh` 需要双重确认
4. **网络要求**: 需要网络连接下载 Docker 镜像

## 🔧 故障排除

### 脚本无法执行
```bash
chmod +x scripts/*.sh
```

### 权限问题
```bash
sudo ./scripts/redeploy.sh
```

### 端口冲突
```bash
# 检查端口占用
netstat -tlnp | grep :3000
netstat -tlnp | grep :8000
netstat -tlnp | grep :1883
```

## 📞 支持

如果遇到问题，请检查：
1. Docker 服务是否运行
2. 端口是否被占用
3. 磁盘空间是否充足
4. 网络连接是否正常
