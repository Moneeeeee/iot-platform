éå¸¸å¥½ ğŸ‘ï¼Œè¿™ä¸€æ­¥æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒã€‚
ä½ æƒ³è¦çš„æ˜¯ä¸€ä¸ªæ¸…æ™°ã€å¯æŒç»­æ‰©å±•çš„ **IoT å¹³å°ç›®æ ‡æ¶æ„è“å›¾**ï¼Œå®ƒè¦æ—¢èƒ½è·‘åœ¨å•å° Ubuntuï¼ˆç”¨ Docker Composeï¼‰ï¼Œåˆèƒ½æœªæ¥å¹³æ»‘è¿ç§»åˆ° Kubernetes é›†ç¾¤ã€‚

æˆ‘æ¥ç»™ä½ ä¸€ä¸ª **ä½ é¡¹ç›®æœ€ç»ˆè¦è¾¾åˆ°çš„æ ‡å‡†æ¶æ„ï¼ˆ2025ç‰ˆäº‘åŸç”Ÿ IoT å¹³å°ç›®æ ‡ç»“æ„ï¼‰**ï¼Œ
è¿™å¥—æ¶æ„æ˜¯ä¸“é—¨ä¸ºä½ ï¼ˆåµŒå…¥å¼ + IoT + äº‘å¹³å°ç»“åˆï¼‰è®¾è®¡çš„ï¼Œå¯ä¸€æ­¥æ­¥æ¼”è¿›ã€‚

---

# ğŸ—ï¸ ç›®æ ‡æ¶æ„æ€»è§ˆï¼ˆFountain IoT Platform 2025ï¼‰

> å…³é”®è¯ï¼š**æ¨¡å—åŒ–å¾®æœåŠ¡ + æ’ä»¶ç³»ç»Ÿ + é…ç½®ä¸­å¿ƒ + å¤šç§Ÿæˆ· SaaS + MQTT + æ—¶åºæ•°æ®åº“**

---

## ğŸŒ ä¸€ã€æ€»ä½“åˆ†å±‚æ¶æ„ï¼ˆå››å±‚ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Frontend Layer                â”‚
â”‚  Next.js 15 + React 19 + Tailwind + Zustand   â”‚
â”‚  SSR / MQTT over WebSocket / å¯è§†åŒ– / æ§åˆ¶å°  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–²
                â”‚ REST / WebSocket / MQTT (WSS)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Backend Layer                 â”‚
â”‚  Fastify + TypeScript + Drizzle ORM + Redis   â”‚
â”‚  æ¨¡å—åŒ–å¾®æœåŠ¡ï¼ˆAuth / Device / OTA / Shadowï¼‰ â”‚
â”‚  gRPC / NATS / EMQX / BullMQ è°ƒåº¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–²
                â”‚ SQL / Stream / Cache
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Infrastructure              â”‚
â”‚  PostgreSQL + TimescaleDB + Redis + MinIO     â”‚
â”‚  Prometheus + Grafana + Loki + Tempo          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–²
                â”‚ MQTT / gRPC / HTTPS
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Device / Edge Layer              â”‚
â”‚  ESP32 / STM32 / RedCap 5G / LoRa / RTU/DTU   â”‚
â”‚  MQTT Client / OTA / Shadow Sync / Edge Cache â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ äºŒã€æ¨¡å—åŒ–å¾®æœåŠ¡æ„æˆ

| æœåŠ¡åç§°                       | æŠ€æœ¯æ ˆ                                  | åŠŸèƒ½è¯´æ˜                   |
| -------------------------- | ------------------------------------ | ---------------------- |
| **auth-service**           | Fastify + JWT + PostgreSQL           | ç»Ÿä¸€è®¤è¯æœåŠ¡ï¼ˆç”¨æˆ·ã€ç§Ÿæˆ·ã€è®¾å¤‡ Tokenï¼‰ |
| **config-service**         | Fastify + Redis + Vault              | åŠ¨æ€é…ç½®ä¸­å¿ƒï¼ˆå‚æ•°ã€å¯†é’¥ã€ç­–ç•¥åˆ†å‘ï¼‰     |
| **device-service**         | Fastify + MQTT + Drizzle             | è®¾å¤‡æ³¨å†Œã€å½±å­åŒæ­¥ã€å¿ƒè·³ç®¡ç†         |
| **telemetry-service**      | Fastify + TimescaleDB                | æ—¶åºæ•°æ®æ¥æ”¶ä¸å­˜å‚¨ï¼ˆä¼ æ„Ÿå™¨æ•°æ®æµï¼‰      |
| **rule-engine**            | Node.js + NATS + Redis               | æ¡ä»¶è§¦å‘ã€åŠ¨ä½œè½¬å‘ã€å‘Šè­¦è§„åˆ™æ‰§è¡Œ       |
| **ota-service**            | Fastify + MinIO + Redis              | OTA å›ºä»¶ä¸Šä¼ ã€ç°åº¦å‡çº§ç®¡ç†        |
| **frontend**               | Next.js 15 + Tailwind + MQTT over WS | æ§åˆ¶å° / å¯è§†åŒ– / å¤šç§Ÿæˆ·ç®¡ç†ç•Œé¢    |
| **emqx**                   | MQTT Broker                          | ä¸»é€šä¿¡é€šé“ï¼šè®¾å¤‡ä¸Šä¸‹è¡Œæ¶ˆæ¯          |
| **redis**                  | Redis 7                              | ç¼“å­˜ã€é˜Ÿåˆ—ï¼ˆBullMQï¼‰ã€ä¼šè¯å­˜å‚¨     |
| **postgres + timescaledb** | PostgreSQL + TimescaleDB             | ä¸»æ•°æ®åº“ + æ—¶åºæ•°æ®åº“           |
| **nats / kafkaï¼ˆå¯é€‰ï¼‰**       | NATS JetStream                       | å¾®æœåŠ¡å¼‚æ­¥é€šä¿¡ä¸æµå¤„ç†            |
| **minio**                  | å¯¹è±¡å­˜å‚¨                                 | è®¾å¤‡æ–‡ä»¶ã€å›ºä»¶ã€æ—¥å¿—å­˜å‚¨           |
| **grafana-stack**          | Prometheus + Loki + Tempo            | å¯è§‚æµ‹æ€§ï¼ˆæŒ‡æ ‡ / æ—¥å¿— / é“¾è·¯è¿½è¸ªï¼‰   |

---

## ğŸ§© ä¸‰ã€Docker Compose éƒ¨ç½²é€»è¾‘

ç›®å½•ç»“æ„ï¼ˆCompose æ¨¡å¼ï¼‰ï¼š

```
/opt/iot-platform
â”œâ”€â”€ backend/          # Fastify æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ frontend/         # Next.js æ§åˆ¶å°
â”‚   â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ components/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ data/             # æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ postgres/
â”‚   â”œâ”€â”€ redis/
â”‚   â”œâ”€â”€ emqx/
â”‚   â””â”€â”€ minio/
â””â”€â”€ docker-compose.yml
```

Compose æ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡å®¹å™¨ï¼š

* æ¯ä¸ªæœåŠ¡ç›¸äº’éš”ç¦»
* æ•°æ®å­˜å‚¨åœ¨ `./data`
* ç½‘ç»œé€šè¿‡ `iot-net` è¿æ¥
* æ‰€æœ‰ç«¯å£å¤–éƒ¨æš´éœ²ç»Ÿä¸€æ¥å£

---

## ğŸŒ å››ã€æ ¸å¿ƒé€šä¿¡é€šé“è®¾è®¡

| é€šé“ç±»å‹            | åè®®                                                                 | ç”¨é€”        | ç¤ºä¾‹                                  |
| --------------- | ------------------------------------------------------------------ | --------- | ----------------------------------- |
| **MQTT**        | mqtt://emqx:1883                                                   | è®¾å¤‡ä¸Šä¸‹è¡Œé€šä¿¡   | `iot/{tenant}/{deviceId}/telemetry` |
| **WebSocket**   | wss://api.fountain.top/ws                                          | å‰ç«¯å®æ—¶é€šä¿¡    | UI å®æ—¶æ•°æ®æ›´æ–°                           |
| **HTTP (REST)** | [https://api.fountain.top/api/v1](https://api.fountain.top/api/v1) | é€šç”¨ API è°ƒç”¨ | è®¾å¤‡æ³¨å†Œ / ç”¨æˆ·ç®¡ç†                         |
| **gRPC / NATS** | å†…éƒ¨å¾®æœåŠ¡é€šä¿¡                                                            | æœåŠ¡é—´è§£è€¦     | auth â†” device â†” telemetry           |

---

## ğŸ” äº”ã€å®‰å…¨ä¸å¤šç§Ÿæˆ·

| å±‚çº§   | æœºåˆ¶                                      | è¯´æ˜           |
| ---- | --------------------------------------- | ------------ |
| è®¤è¯   | JWT / HMAC / Device Token               | è®¾å¤‡ä¸ç”¨æˆ·èº«ä»½éªŒè¯    |
| æˆæƒ   | Role + ACL                              | ç”¨æˆ·ã€ç§Ÿæˆ·ã€è®¾å¤‡è®¿é—®æ§åˆ¶ |
| åŠ å¯†   | HTTPS + MQTT/TLS + Vault                | é€šä¿¡ä¸å¯†é’¥ç®¡ç†      |
| ç§Ÿæˆ·éš”ç¦» | æ•°æ®åº“ schema per tenant + Redis namespace | å®ä½“éš”ç¦»ä¸é…é¢é™åˆ¶    |

---

## ğŸ§  å…­ã€å¼€å‘è¿ç»´ä¸€ä½“åŒ–ï¼ˆDevOpsï¼‰

| ç¯èŠ‚        | å·¥å…·                                   | åŠŸèƒ½       |
| --------- | ------------------------------------ | -------- |
| **éƒ¨ç½²**    | Docker Compose â†’ K8s + Helm + ArgoCD | ä»å•æœºåˆ°äº‘é›†ç¾¤  |
| **ç›‘æ§**    | Prometheus + Grafana                 | èµ„æºä¸æŒ‡æ ‡ç›‘æ§  |
| **æ—¥å¿—**    | Loki + Tempo + Grafana               | æ—¥å¿—ä¸åˆ†å¸ƒå¼è¿½è¸ª |
| **ä»»åŠ¡é˜Ÿåˆ—**  | BullMQ + Redis                       | å¼‚æ­¥ä»»åŠ¡è°ƒåº¦   |
| **CI/CD** | GitHub Actions / GitLab CI           | è‡ªåŠ¨æ„å»ºä¸éƒ¨ç½²  |

---

## ğŸ“ˆ ä¸ƒã€æ¼”è¿›è·¯çº¿å›¾

| é˜¶æ®µ          | æ¶æ„ç›®æ ‡                           | å¯è¿è¡ŒèŒƒå›´          |
| ----------- | ------------------------------ | -------------- |
| **Phase 1** | å•æœº Docker Compose ï¼ˆä½ ç°åœ¨é˜¶æ®µï¼‰      | Ubuntu æœåŠ¡å™¨     |
| **Phase 2** | æ¨¡å—åŒ–å¾®æœåŠ¡ + å†…éƒ¨é€šä¿¡                  | Docker Compose |
| **Phase 3** | åˆ†å¸ƒå¼éƒ¨ç½² + NATS + MinIO + Grafana | å¤šèŠ‚ç‚¹ Docker     |
| **Phase 4** | å®Œæ•´äº‘åŸç”ŸåŒ–ï¼ˆK8s + ArgoCD + Helmï¼‰    | ä»»æ„äº‘å¹³å°          |

---

## âœ… å…«ã€ç›®æ ‡ï¼šæœ€ç»ˆå½¢æ€

ä½ çš„æœåŠ¡å™¨å¯åŠ¨åï¼š

```bash
docker compose up -d
```

ç„¶åï¼š

* ğŸŒ è®¿é—®å‰ç«¯ï¼š`http://your-ip:3000`
* âš™ï¸ åç«¯æ¥å£ï¼š`http://your-ip:8000/health`
* ğŸ§© MQTT æ§åˆ¶å°ï¼š`http://your-ip:18083`
* ğŸ“Š æ•°æ®åº“ï¼š`PostgreSQL + TimescaleDB`
* ğŸ§  Redis ç¼“å­˜ï¼š`redis://your-ip:6379`
* ğŸ“¡ è®¾å¤‡è¿æ¥ï¼š`mqtt://your-ip:1883`
* ğŸ” ç›‘æ§é¢æ¿ï¼š`http://your-ip:3000/admin/monitor`

---

æ˜¯å¦å¸Œæœ›æˆ‘æ¥ç€ä¸ºä½ ç”Ÿæˆï¼š
âœ… `/opt/iot-platform/docker-compose.yml`ï¼ˆå®Œå…¨åŒ¹é…ä¸Šé¢æ¶æ„ï¼‰
âœ… `/backend` çš„æœ€å° Fastify æ¨¡æ¿
âœ… `/frontend` çš„ Next.js åˆå§‹æ¨¡æ¿

è¿™æ ·ä½ å¯åŠ¨ä¸€æ¬¡ `docker compose up -d` å°±èƒ½çœ‹åˆ°ç³»ç»Ÿå®Œæ•´è¿è¡Œã€‚
